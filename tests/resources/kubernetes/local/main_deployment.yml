kind: Deployment
apiVersion: apps/v1beta2
metadata:
  name: testleo-main-deployment
  labels:
    app: testleo
    type: main
spec:
  selector:
    matchLabels:
      app: testleo
      type: main
  replicas: 2
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxSurge: 50%
      maxUnavailable: 50%
  template:
    metadata:
      labels:
        app: testleo
        type: main
        version: 1.0.0
  initContainers:
    - name: kong-setup-service
      image: appropriate/curl:latest
      command:
        - sh
        - /setup-service.sh
      volumeMounts:
        - name: kong-service-script
          mountPath: /setup-service.sh
          readOnly: true
  containers:
    - name: app
      image: testleo-app:1.0.0
      imagePullPolicy: IfNotPresent
      ports:
        - containerPort: 5000
          hostPort: 5000
  volumes:
    - name: kong-service-script
      hostPath:
        path:  {{ROOT}}/testleo/kong/setup-service-kube.sh
